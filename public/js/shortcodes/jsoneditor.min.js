import{getFirstAncestorByClass}from"../theme/modules/helpers.min.js";document.addEventListener("DOMContentLoaded",function(){renderAllJsoneditor(),initBulmaToast()});function initBulmaToast(){bulmaToast.setDefaults({closeOnClick:!0,dismissible:!1,duration:2e3,pauseOnHover:!0,position:"bottom-right",type:"is-danger",extraClasses:"sc-jsoneditor-toast-error"})}function renderAllJsoneditor(){let e=document.getElementsByClassName("sc-jsoneditor-container");for(let t=0;t<e.length;t++)renderJsoneditor(e[t])}function renderJsoneditor(e){const c=document.getElementById(e.id+"-action-wrapper"),n=document.getElementById(e.id+"-copy"),t=document.getElementById(e.id+"-download"),o=e.id+"-error",i=document.getElementById(o),a=e.getAttribute("post-analyze-function"),r=e.getAttribute("post-process-function"),l=e.getAttribute("filename-to-download-function");i&&i.remove();const s=getFirstAncestorByClass(e,"sc-jsoneditor-wrapper"),d=new Promise(e=>e());d.then(()=>getJsonSchema(e.getAttribute("jsoneditor-url"))).then(o=>{const c=JSON.parse(o);let i=new JSONEditor(e,{array_controls_top:!1,disable_array_delete_all_rows:!0,disable_array_delete_last_row:!0,disable_collapse:!1,disable_edit_json:!0,disable_properties:!0,iconlib:"fontawesome5",prompt_before_delete:!1,remove_button_labels:!0,schema:c,theme:"barebones"});n.addEventListener("click",()=>{validateSchema(a,i,e.id)?(n.setAttribute("title-after",codeCopyAfter),navigator.clipboard.writeText(JSON.stringify(maybePostProcessJson(r,i),null,2))):n.removeAttribute("title-after",codeCopyAfter)}),t.addEventListener("click",()=>{validateSchema(a,i,e.id)?(URL.revokeObjectURL(t.href),t.href=URL.createObjectURL(new Blob([JSON.stringify(maybePostProcessJson(r,i),null,2)],{type:"application/json"})),t.download=getFilenameToDownload(l,i,e.id)):(t.removeAttribute("href"),t.removeAttribute("download"))}),s.classList.toggle("is-loading",!1)}).catch(t=>{const n=document.createElement("div");for(n.classList.add("sc-alert","sc-alert-error"),n.innerHTML=t,n.id=o;e.lastChild;)e.removeChild(e.lastChild);s.classList.toggle("is-loading",!1),s.insertAdjacentElement("afterbegin",n),c.classList.toggle("is-hidden",!0),e.classList.toggle("is-hidden",!0)})}function getJsonSchema(e){const t=new XMLHttpRequest;if(t.open("GET",e,!1),t.send(null),t.status===200)return t.responseText;throw new Error(`Error getting content at ${e} ${t.status} ${t.statusText}`)}function validateSchema(e,t,n){let s=t.validate();return typeof window[e]=="function"&&(s=s.concat(window[e](t.schema,t.getValue()))),!s.length||(s.forEach(e=>bulmaToast.toast({message:`${jsoneditorValidateError}: ${e.message} at '${e.path}'`,appendTo:document.getElementById(n)})),!1)}function maybePostProcessJson(e,t){return typeof window[e]=="function"?window[e](t.schema,t.getValue()):t.getValue()}function getFilenameToDownload(e,t,n){return typeof window[e]=="function"?window[e](t.schema,t.getValue()):t.schema.title?`${t.schema.title}.json`:`${n}.json`}